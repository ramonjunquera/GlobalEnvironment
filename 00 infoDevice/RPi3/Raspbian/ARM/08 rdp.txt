Cómo instalar el servicio de escritorio remoto (RDP) de Microsoft.

Raspbian ya viene con un sistema para su control remoto basado en VNC.
El protocolo para RDP lo realiza el mismo servidor VNC, pero una versión más completa.
Es necesario desinstalar el servidor VNC por defecto y sustituirlo por la otra versión.
Si instalamos el protocolo RDP se desactivará la posibilidad de utilizar VNC.

Seguiremos los siguientes pasos:
1. Desinstalamos el VNC por defecto
2. Actualizamos todos los paquetes
3. Instalamos el servidor RDP


1. Desinstalamos el VNC por defecto
Con la siguiente línea desinstalamos todos los paquetes pertenecientes al VNC que viene
por defecto:
  sudo apt-get remove xrdp vnc4server tightvncserver realvnc-vnc-server
Por si acaso, también quitamos los posibles paquetes no utilizados
  sudo apt-get autoremove

2. Actualizamos todos los paquetes (optativo pero muy conveniente)
Este paso no es obligatorio, pero sí muy conveniente.
  sudo apt-get update
  sudo apt-get upgrade

3. Instalamos el servidor RDP
Instalaremos el nuevo servidor VNC que incluye funcionalidades para RDP
  sudo apt-get install tightvncserver
Finalmente instalamos el protocolo de escritorio remoto
  sudo apt-get install xrdp

Hemos terminado la instalación.
Ahora, desde cualquier Windows podemos abrir un cliente de RDP y conectar con nuestra Raspberry.
Debemos rellenar tres campos:
  Module: Seleccionamos siempre el valor sesman-Xvnc
  username: El usuario por defecto es pi
  password: La contraseña por defecto es raspberry
La conexión no es instantánea. Requiere unos 10 segundos.


Notas:
Cuando nos conectamos por RDP, realmente no tomamos el control de la
sesión abierta actualmente (la pantalla actual) como con VNC, sino que se
abre una nueva que nos permite redimensionarla a pantalla completa.

El control remoto por RDP permite un mejor refresco de pantalla, sin
cortes, ni bloqueos, ni zonas que se quedan sin actualizar, como ocurre en VNC.

NO funciona la compartición del portapapeles entre el cliente y el servidor, aunque se indique que lo haga.


Bonus 1 : Cambio de puntero
Cuando abrimos una sesión de escritorio remoto a  nuestra Raspberry comprobamos que el cursor por
defecto se ha convertido en una cruz en vez de la flecha estandar.
Se puede corregir de la siguiente manera:
1. Ir a la carpeta /home/pi con: cd ~ (el símbolo ~ se puede obtener con MAYUS+\ en un teclado inglés)
2. Crear un archivo de texto llamado .xsessionrc con: nano .xsessionrc
3. Escribimos el siguiente texto en el archivo: xsetroot -cursor_name left_ptr&
   El carácter - se obtiene con ' en un teclado inglés
   El carácter _ se obtiene con MAYUS+' en un teclado inglés
   El carácter & se obtiene con MAYUS+7 en un teclado inglés
4. Guardamos los cambios al salir con: CRTL+X y pulsamos "y" para confirmar el guardado y ENTER para conservar
   el nombre original del archivo
5. Hacemos el archivo ejecutable con: chmod +x .xsessionrc
   El carácter + se obtiene con MAYUS+¡ en un teclado inglés
6. Reiniciamos el servicio de xrdp con: sudo service xrdp restart

Bonus 2 : Fijar las credenciales de sesión
Desde el mismo cliente de escritorio remoto se puede fijar el usuario y se puede permitir guarda la contraseña.
Esto evitará que se vuelva a pedir en sucesivas conexiones.

Bonus 3 : Cambiar la configuración de teclado a castellano
1. Copiamos el archivo files/km-040a.ini correspondiente a la configuración de teclado en
   castellano a /home/pi con el explorador de archivos (carpeta en la que podemos escribir)
2. Nos cambiamos a la carpeta deseada con: cd /etc/xrdp
3. Movemos el archivo a la carpeta correcta con: sudo mv /home/pi/km-040a.ini /etc/xrdp
4. Tomamos el nuevo archivo como propietario con: sudo chown xrdp.xrdp km-040a.ini
5. Reiniciamos el servicio de xrdp con: sudo service xrdp restart
