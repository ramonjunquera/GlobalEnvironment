Tema: Descripción de placa LILYGO TTGO_T18 (v 1, 2 y 3)
Fecha: 20211221
Autor: Ramón Junquera

Identificación de versión
Existen varias versiones de este modelo
- Versión 1.0 La placa no tiene ningún texto escrito en su parte superior
- Versión 2.2 Entre el interruptor y el conector USB el texto es "20181120 T18_2.2"
- Versión 3.0 Entre los botones boot & EN el texto es "T18_3.0 20190410"

General
En Platformio no hay un perfil de dispositivo específico. Utilizaremos el genérico para ESP-WROOM-32
No se puede conectar a una breadboard, debido a la caja de batería que tiene en su parte inferior.
Tiene dos hileras de 20 pines cada una.
http://www.lilygo.cn/prod_view.aspx?TypeId=50033&Id=1170&FId=t3:50033:3

Procesador
La placa está basada en el microprocesador ESP-WROOM-32 de Espressif.
Este procesador tiene 2 cores a 240MHz y 4Mb de RAM (flash memory).
Uno de los cores se utiliza exclusívamente para comunicaciones. El otro para desarrollos de usuario.
El procesador es un Tensilica Xtensa 32-bits LX6
Tiene Wifi incluido y soporta los protocolos 802.11 b/g/n
Tiene Bluetooth integrado y soporta el protocolo 4.2 LE.
Como el resto de dispositivos de la familia ESP32, todos los pines funcionan a 3.3V.

Alimentación
Tiene un puerto microusb para la transferencia de datos y alimentación.
Por la parte de abajo tiene una caja que puede albergar una batería de tipo 18650 (3.7V).
El dispositivo incluye la gestión de la batería.
Se puede cargar la batería por el puerto USB con 5V, mientras esto ocurre se enciende un led rojo.
Cuando la batería está totalmente cargada se enciende uno verde.
Si estamos utilizando la alimentación por batería, no se encenderá ninguna de estos leds.
Se puede utilizar mientras se carga.
La placa incluye un interruptor para controlar la alimentación de la placa.
En OFF la placa NO se alimenta (no se ejecutan programas).
Este interruptor no afecta a la recarga de la batería.
Podemos poner el interruptor en OFF, pero si conectamos el puerto microusb la batería se cargará.

LED
Tiene un led azul integrado. Su pin depende de la versión:
v1.0 = pin 16, HIGH = off, LOW = on
v3.0 = pin  5, HIGH =  on, LOW = off

Botones
Tiene 2 botones:
- Boot: aceptar transferencia de datos por USB
- EN : reset

Transferencia de programas
En la versión 1.0, cuando finalice la compilación y comience el intento de transferencia de programa, es necesario
mantener pulsado el botón "Boot" hasta que lo reconozca (unos 3 segundos).
Ocurre lo mismo cuando queremos transferir una imagen de un sistema de archivos.

Lectura de batería
En la versión 2.2 y superiores se incluye un divisor de voltaje con resistencias de 100K desde el ánodo de
la batería al pin 35, lo que le añade un consumo de 21uA.
Gracias a que el pin 35 también corresponde a ADC1_7, podemos leer el voltaje de la batería incluso con
el WiFi activado (el WiFi utiliza los servicios de ADC2, no el ADC1).
Obtendremos la mitad del voltaje.
Si nuestro T18 no es versión 3.0, tendremos que soldar un cable adicional al ánodo de la batería para poder
hacerlo.

  
  Pinout
  ------
                               ---------------------
                               |        |  |       |
                               ||       ----     |=|
                              -||                |=|
                               |                   |
                Not Connected -|NC               NC|- Not Connected
                              -|CLK              5V|- 5V
                              -|SD0             CMD|- 
                              -|SD1             SD3|- 
TOUCH3/WSPI_CSO/ADC2_3/GPIO15 -|15              SD2|- 
  TOUCH2/HSPI_WP/ADC2_2/GPIO2 -|2                13|- GPIO13/SDC2_4/TOUCH4
     CLX1/TOUCH1/ADC2_1/GPIO0 -|0               GND|- GND
  TOUCH0/HSPI_HD/ADC2_0/GPIO4 -|4                12|- GPIO12/ADC2_5/TOUCH5
                       GPIO16 -|16               14|- GPIO14/ADC2_6/TOUCH6
                       GPIO17 -|17               27|- GPIO27/ADC2_7/TOUCH7
              V_SPI_CSO/GPIO5 -|5                26|- GPIO26/ADC2_9/DAC1
              VSPI_CLK/GPIO18 -|18               25|- GPIO25/ADC2_8/DAC2
        V0_CTS/V_SPI_Q/GPIO19 -|19   ---------   33|- GPIO33/ADC1_5/XTAL33
                          GND -|GND  |       |   32|- GPIO32/ADC1_4/TOUCH3/XTAL32
   SDA/V_SPI_HD/ADC2_3/GPIO21 -|21   |       |   35|- GPIO35/ADC1_7
            CLX2/V0_RXD/GPIO3 -|RX   |       |   34|- GPIO34/ADC1_6
            CLX3/V0_TXD/GPIO1 -|TX   |       |  SVN|- GPIO39/ADC1_3/S_VN
          SCL/V_SPI_WP/GPIO22 -|22   |       |  SVP|- GPIO36/ADC1_0/S_VP
               V_SPI_D/GPIO23 -|23   |       |   EN|- 
                          GND -|GND  ---------  VCC|- 3.3v
                               |                   |
                               |                   |
                               |                   |
                               |o Boot         EN o|
                               |                   |
                               ---------------------

Inconvenientes:
- El conector de USB es muy delicado. Con muy pooca fuerza comienza a despegarse de la placa.
- Las soldaduras de la caja de batería son muy delicadas. No se deberían tocar sus soldaduras.